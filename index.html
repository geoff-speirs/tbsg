<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
</head>

<body></body>
<p id="test_failures">
</p>
<p id="map" style="white-space: pre;">
  Starting...
</p>

<script>  
  class Player {
    constructor(x, y){
      this.x = x;
      this.y = y;
    }
    moveRight(){
      this.x += 1;
    }
    moveLeft(){
      this.x -= 1;
    }
  }
  
  const PlayerCommand = {
    MoveRight: "MoveRight",
    MoveLeft: "MoveLeft"
  }
  
  class Game {
    constructor(player){
      this.player = player;
    }
    update(command){
      if (command === PlayerCommand.MoveRight){
        this.player.moveRight();
      } else if (command === PlayerCommand.MoveLeft){
        this.player.moveLeft();
      }
    }
  }
  
  const render = (map) => {
    return map.map((lines) => lines.map(tile => { 
        if (tile instanceof Player) return "P";
        return "T";
      }).join("")).join("\n");
  };
  
  {
    const assertEqual = (expected, result, message) => {
      if (expected !== result){
        const detailMsg = message ?? "";
        throw new Error(`${detailMsg}: Expected ${result} to be ${expected}`);
      }
    };
    
    tests = [
      ["rendering tiles", 
        [
          ["T", [[1]]],
          ["TT", [[1,2]]],
          ["TT\nTT", [[1,2],[3,4]]]
        ],
        ([expected, data]) => {
          const result = render(data);
          assertEqual(expected, result);
        }
      ],
      ["rendering player",
        [
          ["TT\nTP", [[1,2],[3,new Player()]]]
        ],
        ([expected, data]) => {
          const result = render(data);
          assertEqual(expected, result);
        }
      ],
      ["moving player",
        [
          [[1, 0], [0, 0], PlayerCommand.MoveRight, "right"],
          [[0, 0], [1, 0], PlayerCommand.MoveLeft, "left"]
        ],
        ([[expectedX, expectedY], [startX, startY], command, message]) => {
          player = new Player(startX, startY);
          game = new Game(player);
          game.update(command, player);
          assertEqual(expectedX, game.player.x, message);
          assertEqual(expectedY, game.player.y, message);
        }
      ]
    ];
  
    var failures = [];
    tests.forEach(([description, dataList, test]) => dataList.forEach((data) => {
        try{
          test(data);
        }
        catch (error) {
          failures.push(`Error ${description} ${error.message}`);
        }
      })
    );
    document.getElementById("test_failures").textContent = failures.join("\n");
  }
  
  const map = document.getElementById("map");
  map.textContent = render([[1,2],[3,new Player()]]);
  
</script>
</body>

</html>