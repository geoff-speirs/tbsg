<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
</head>

<body></body>
<p id="test_failures">
</p>
<p id="map" style="white-space: pre;">
  Starting...
</p>

<script>  
  class Player {
    constructor(x, y){
      this.x = x;
      this.y = y;
    }
    moveRight(){
      this.x = this.x + 1;
    }
  }
  
  const PlayerCommand = {
    MoveRight: "MoveRight"
  }
  
  class Game {
    constructor(player){
      this.player = player;
    }
    update(command){
      if (command === PlayerCommand.MoveRight){
        this.player.moveRight();
      }
    }
  }
  
  const render = (map) => {
    return map.map((lines) => lines.map(tile => { 
        if (tile instanceof Player) return "P";
        return "T";
      }).join("")).join("\n");
  };
  
  {
    const assertEqual = (expected, result) => {
      if (expected !== result){
        throw new Error(`Expected ${result} to be ${expected}`);
      }
    };
    
    tests = [
      ["renders tiles", 
        [
          ["T", [[1]]],
          ["TT", [[1,2]]],
          ["TT\nTT", [[1,2],[3,4]]]
        ],
        ([expected, data]) => {
          const result = render(data);
          assertEqual(expected, result);
        }
      ],
      ["renders player",
        [
          ["TT\nTP", [[1,2],[3,new Player()]]]
        ],
        ([expected, data]) => {
          const result = render(data);
          assertEqual(expected, result);
        }
      ],
      ["moves player",
        [
          [[1, 0], [0, 0], PlayerCommand.MoveRight]
        ],
        ([[expectedX, expectedY], [startX, startY], command]) => {
          player = new Player(startX, startY);
          game = new Game(player);
          game.update(command, player);
          assertEqual(expectedX, game.player.x);
          assertEqual(expectedY, game.player.y);
        }
      ]
    ];
  
    var failures = [];
    tests.forEach(([description, dataList, test]) => dataList.forEach((data) => {
        try{
          test(data);
        }
        catch (error) {
          failures.push(`Error in ${description}: ${error.message}`);
        }
      })
    );
    document.getElementById("test_failures").textContent = failures.join("\r\n");
  }
  
  const map = document.getElementById("map");
  map.textContent = render([[1,2],[3,new Player()]]);
  
</script>
</body>

</html>